(function(b){function j(b){return!!b.offsetParent}function h(b,e){for(var e=e||"data-",a={},i,c=[],f=0,d=b.attributes,m=d.length;f<m;f++)i=d.item(f).nodeName,0===i.indexOf(e)&&c.push(i);c.forEach(function(m){a[m.split(e)[1]]=b.getAttribute(m)});return a}function n(b){var e=["hippo","ga"][b.type];b.configInfo.forEach(function(a){var b={selector:"body"==a.parent?a.selector:a.parent?[a.parent,a.selector].join(" "):a.selector,key:a.moduleId,actions:a.actions,isSync:!!a.isSync},c=function(a){var c=p(d),
g,c=q(c).indexOf(this)+1;g=h(this);var t=h(this,"data-"+e+"-"),l={index:c};k(l,r);k(l,g);k(l,t);g=s(b.key,l);f.call(this,s(g,{n:c}),a,l,b.isSync)},f=u[e],d=b.selector;b.actions.forEach(function(a){if("show"==a)v(function(){f.call(q(p(d)).filter(j),b.key,a,{})});else if(a="hover"===a?"mouseenter":a,b.lazy||!location.href.match("search/category"))w(a,d,function(){c.call(this,a)});else p(d).on(a,function(){c.call(this,a)})})})}function o(b,e){if(window.nuggetInited)window.console&&console.warn("nugget is already initiated");
else{window.nuggetInited=!0;e&&(b=h(document.getElementById("nugget")));var a;a=document.scripts;for(var i=null,c=0,f=a.length;c<f;c++){var d=a[c].innerHTML;d.match(/_setPageId/)&&(i=d)}a=(new Function(i+"\nreturn _hip"))().filter(function(a){return"_setPageId"==a[0]})[0][1];k(r,b);a?(i=window._nuggetIsProduct?!0:location.host.match(".dianping.com"),x("http://"+(i?"nugget.dianping.com":"192.168.215.64")+"/jsonp/loggingconfig?pageId="+a,function(a){a.success?a.result.forEach(n):window.console&&console.warn(a.message)})):
window.console&&console.warn("nugget:pageId not specified")}}var p=b.$,k=b.mix,q=b.toElem,s=b.sub,x=b.jsonp,w=b.live,y=b.getJSON,v=b.ready,u={ga:function(b){_gaq.push(["_trackPageview",b||""])},hippo:function(b,e,a,i){function c(a){var b="";if(a){for(;a!==document.body&&!(b=a.getAttribute("href")||"");)a=a.parentNode;return b}return""}function f(a){return a&&(a.getAttribute("title")||a.innerText||a.textContent)}var a=a||{},d="number"==typeof this.length&&this.slice;Object.keys(a).filter(function(a){return 0===
a.indexOf("hippo-")}).forEach(function(b){a[b.split("hippo-")[1]]=a[b];delete a[b]});if(!d||this.length){var h=d?this.map(c).join("|"):c(this),j=d?this.map(f).join("|"):f(this);d&&(a.index=this.map(function(a,b){return b+1}).join("|"));var g=k({module:b,action:"show"==e?"browse":e,content:h,title:j},a);y(function(a){var b=[g],a=encodeURIComponent(a.stringify(g)).length,c=g.content.split("|"),d=g.title.split("|"),e=(g.index+"").split("|");a>1548&&(b=c.map(function(a,b){var f=k({},g);k(f,{content:c[b],
title:d[b],index:e[b]});return f}));b.forEach(function(a){_hip.push(["mv",a,i])})})}}},r={n:"{n}"};document.getElementById("nugget")&&document.getElementById("nugget").src?o(null,!0):window.DP&&DP.define&&DP.define([],function(){return{init:o}})})({$:$.all,sub:DP.sub,mix:DP.mix,toElem:function(b){return b.el()},live:function(b,j,h){DP.provide("event/live",function(n,o){o.on("body",b,j,h)})},getJSON:function(b){DP.provide(["util/json"],function(j,h){b(h)})},jsonp:function(b,j){DP.provide(["io/jsonp"],
function(h,n){(new n({url:b})).on("success",j).send()})},ready:function(b){DP.ready(b)}});
